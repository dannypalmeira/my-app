import { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import { supabase } from '@/lib/initSupabase';
import FilmeCard from '@/components/FilmeCard'; 

const SearchBar = () => {
  const [searchResults, setSearchResults] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const router = useRouter();

  const { titulo } = router.query;

  useEffect(() => {
    const getFilme = async () => {
      if (!titulo) return;

      const { data } = await supabase
        .from("filmes")
        .select("*")
        .filter("titulo", "like", `%${titulo}%`);
      setSearchResults(data);
    };

    getFilme();
  }, [titulo]);

  const handleSearch = async () => {
    const { data } = await supabase
      .from("filmes")
      .select("*")
      .filter("titulo", "ilike", `%${searchTerm}%`);
    setSearchResults(data);
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    handleSearch();
  };

  const handleChange = (e) => {
    setSearchTerm(e.target.value);
  };

  return (
    <div>
      <form onSubmit={handleSubmit}>
        <input
          type="text"
          name="search"
          placeholder="Search by title"
          value={searchTerm}
          onChange={handleChange}
        />
        <button type="submit">Search</button>
      </form>

      {searchResults.length === 0 && searchTerm && <p>No results found.</p>}
      <FilmeCard data={searchResults.length > 0 ? searchResults : titulo} />
    </div>
  );
};

export default SearchBar;
